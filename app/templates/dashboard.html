{% extends "base.html" %}
{% block title %}Dashboard - AuthCenter{% endblock %}

{% block card_style %}max-width: 560px;{% endblock %}

{% block content %}
<style>
    .card { max-width: 560px; }
    .user-info { margin-bottom: 24px; font-size: 14px; color: var(--text-muted); line-height: 1.8; }
    .user-info strong { color: var(--text-main); }
    .app-list { list-style: none; padding: 0; margin: 0; }
    .app-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 10px;
    }
    .app-item:last-child { margin-bottom: 0; }
    .app-meta { flex: 1; }
    .app-name { font-size: 15px; font-weight: 600; color: var(--text-main); margin-bottom: 4px; }
    .app-scopes { font-size: 12px; color: var(--text-muted); }
    .app-source {
        display: inline-block;
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 4px;
        margin-left: 6px;
    }
    .source-personal { background: #dbeafe; color: #1d4ed8; }
    .source-dept { background: #f3f4f6; color: #6b7280; }
    .scope-tag {
        display: inline-block;
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 3px;
        background: #f0fdf4;
        color: #166534;
        margin-right: 4px;
    }
    .app-link {
        display: inline-block;
        padding: 6px 14px;
        font-size: 13px;
        font-weight: 500;
        color: var(--primary);
        border: 1px solid var(--primary);
        border-radius: 6px;
        text-decoration: none;
        white-space: nowrap;
        margin-left: 12px;
    }
    .app-link:hover { background: var(--primary); color: #fff; }
    .empty-state { text-align: center; color: var(--text-muted); font-size: 14px; padding: 24px 0; }
</style>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

{% if staff %}
<div class="user-info">
    <strong>{{ staff.name }}</strong>（{{ staff.employee_name }}）<br>
    部門：{{ staff.dept_code }} ｜ Level {{ staff.level }}
</div>

<h2 style="font-size: 16px; font-weight: 600; margin-bottom: 14px;">可存取的應用程式</h2>

{% if apps %}
<ul class="app-list">
{% for app in apps %}
    <li class="app-item">
        <div class="app-meta">
            <div class="app-name">
                {{ app.name }}
                {% if app.source == "personal" %}
                <span class="app-source source-personal">個人授權</span>
                {% else %}
                <span class="app-source source-dept">部門/等級</span>
                {% endif %}
            </div>
            <div class="app-scopes">
                {% for scope in app.scopes %}
                <span class="scope-tag">{{ scope }}</span>
                {% endfor %}
            </div>
        </div>
        {% if app.redirect_uri %}
        <a href="/auth/login?app_id={{ app.app_id }}&redirect_uri={{ app.redirect_uri }}" class="app-link">前往</a>
        {% endif %}
    </li>
{% endfor %}
</ul>
{% else %}
<div class="empty-state">目前沒有可存取的應用程式。</div>
{% endif %}
{% endif %}
{% endblock %}

{% block links %}
<a href="/auth/change-password">修改密碼</a>
{% endblock %}
